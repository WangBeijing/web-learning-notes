## 区块链2.0架构：以太坊区块链

比特币的区块链架构主要围绕支持虚拟货币的实现，虽然它有一定的灵活性，但用来支持虚拟货币以外的应用场景还明显非常局限。区块链2.0的概念也随之产生，其核心理念是把区块链作为一个可变成的分布式信用基础设施，支持智能合约应用，以与过去的比特币区块链作为一个虚拟货币支撑平台区别开来。不仅仅把区块链作为一个去中心化的虚拟货币和支付平台，而是通过增加链上扩展性功能，把区块链技术范围扩展到支撑一个去中心化的市场。

区块链2.0提供一套新的协议，支持新型的去中心化应用。其中最具代表性的以太坊平台。

以太坊的设计主要还是以比特币架构为基础。

![images](https://github.com/WangBeijing/webBlog/blob/master/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF/images/1441538443654.jpg?raw=true)
以太坊架构

**1.账户设计**
比特币没有账户的概念。每个用户的余额都是从他们在区块链上的UTXO计算出来的。以太坊则有两种类型的账户:外部所有账户（EOA）、合约（Contract）账户。

以太坊的设计是将区块链作为一个通用的管理对象状态转换的去中心化平台，账户就是有状态的对象。

**2.区块链设计**

比特币采用Merkle树来将交易的哈希值按一定算法组成二叉树状结构，顶层节点的哈希值相当于整个交易清单的指纹，可以用来校验交易清单。

以太坊的区块链的每个区块不但保存这交易清单，还保存着最新的状态。
另外一个和比特币不同的是，以太坊的区块链中的每个区块保存区块链号和区块难度。

**3.PoW机制**

以太坊的PoW(工作量证明)算法叫Ethash算法（是一个经过修改的Dagger-Hashimoto算法），该算法主要寻找一个随机数作为输入，使得运算结果小于一个特定的难度门槛。

比特币的工作量证明机制依靠的仅仅是CPU计算难度问题，以太坊的Ethash工作量证明机制加入内存难度，使得它具有抵抗单凭哈希运算优化的ASIC挖矿机的属性。

以太坊的Go语言实现程序geth和C语言实现挖矿程序ehminer都实现了自动DAG生成，并在epoch转换的过程中维护两个DAG。

**4.计算和图灵完备**

以太坊作为通用的区块链平台，需要提供比特币更强大的计算能力。

**5.EVM高级语言**

比特币不提供高级语言的支持，以太坊则提供高级语言让用户编写智能合约。

**6.以太坊P2P网络**

- 1）RLPx协议
- 2）Whisper协议

**7.事件**

合约是在区块验证的时候被交易触发。

以太坊中的事件是一个以太坊日志和事件监测的协议的抽象。

#### 区块链3.0架构：超越火币、金融范围的区块链应用

区块链3.0的应用场景很多，下面介绍一些典型的应用

- （1）自动化采购
- （2）智能化物联网应用
- （3）供应链自动化管理
- （4）虚拟资产兑换、转移
- （5）产权登记


### 互联链架构剖析

比特币的出现，特别是其不依赖中心化机构而解决的双花问题，以及以极小的成本能使用户在陌生网络中建立信用，使得大家意识到传统的中心化支付系统需要重新构建

**定义7：互联链**

提供实现不同区块链互联互通的统一架构和标准

#### 互联账本

分布式账本初创公司的Ripple Labs提出了一种与比特币不同的共识机制的分布式账本，并创造自己代币瑞波币（XRP）

**定义8：账本（Ledger）**

资金转账系统需要记录在保持状态的系统中，以防止同一笔资金被双花。这种状态保持的系统为账本。账本包含账户，账户有资产余额，余额可以为正为负

**定义9：连接器（Connecttors）**

资产可以在同一账本中的账户间转账，也可以在两个不同账本中的账户间转账。如果两个不同账本间的转账，需要有一个系统知道这两个转账交易的关系，这个系统就是连接器

#### 互联账本协议组
受互联网层次架构的启发，Ripple提出了互联账本（Interledger）协议层架构。
![images](https://github.com/WangBeijing/webBlog/blob/master/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF/images/1451538445107.jpg?raw=true)

整个协议层分成4层。下面简单介绍这4层功能。

**1.账本层**

为了支持账户间的转账，账本必须实现一个API和协议，称为账本层（Ledger Layer）。

- 1）简单账本协议
- 2）区块链协议（如比特币）
- 3）传统支付协议
- 4）专有钱包协议
- 5）其他专有协议

**2.互联账本层**

互联帐协议能保证不同的连接器能互相操作，共同完成交易的路由。

- 1)互联账本协议
- 2)互联帐报价协议
- 3)互联账本协议

**3.传输层**

传输层协议负责协调不同的转账交易，使它们能进行跨账本转账的交易。转账的安全性取决于采用不同的传输协议。传输层为应用提供端对端的传输服务。目前3种主要传输层协议：

- 乐观传输协议
- 通用传输协议
- 原子传输协议

**4.应用层**

应用层是互联账本协议的最高一层。应用协议层包括开发web支付机制（OWPS）、简单支付建立协议（SPSP）、私有协议，如瑞波支付服务协议（RPSP）开放协议。

#### 互联账本各层协议关系

互联账本架构中，各层关系类似互联网的各层协议，每层只与相邻层做交互，不会跨层通信。支付由应用层发起，应用层调用传输层接口，传输层再调用互联账本层的接口，最后互联账本层通过调用账本层接口把包含目的地址连接器的支付请求发到账本层的连接器，账本层的连接器根据目的地址将支付请求发到对方账本的连接器，实现支付请求的发起。目的账本的连接器在接收到支付请求后，通过调用上层的互联账本层接口，把请求转到传输层，进而再转发到应用层，这样接收方接收到请求。支付的响应也通过相同的路径返回给支付发起方，实现支付功能。

互联账本协议还处于非常初级概念模型阶段，离实际应用还有很大的一段距离。

> 小结：深度剖析区块链1.0 区块链2.0，同时具有前瞻性的区块链3.0架构。可以深入了解在组件级的比特币架构同时了解以以太坊为代表的区块链2.0架构的和比特币架构的异同。
