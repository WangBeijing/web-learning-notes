## 与HTTP协作的Web服务器
一台Web服务器可搭建多个独立域名的Web网站，也可作为通信路径上的中转服务器提升传输效率。

#### 用单个虚拟主机实现多个域名
在互联网上，域名通过DNS服务映射到IP地址（域名解析）之后访问目标网站。可见，当请求发送到服务器时，已经是以IP地址形式访问了。

#### 通信数据转发程序：代理、网关、隧道
**代理**
代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时也接收从那台服务器发送的响应再转发给客户端。

**网关**
网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。

**隧道**
隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。

###### 1.代理
代理服务器的基本行为就是接受客户端发送的请求后转发给其他服务器。代理不改变请求URI，会直接发送给前方持有资源的目标服务器。

持有资源实体的服务器被称为源服务器。从源服务器返回的响应经过代理服务器后再传给客户端。

> 每次通过代理服务器转发请求或响应时，会追加写入Via首部信息

使用代理服务器的理由有：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的

代理有多种使用方法，按两种基准分类
- 是否使用缓存
- 是否会修改报文

**缓存代理**

代理转发响应时，缓存代理会预先将资源的副本（缓存）保存在代理服务器上

当代理再次接收到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前缓存的资源作为响应返回。

**透明代理**

转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理。反之，对报文内容进行加工的代理被称为非透明代理。

##### 2.网关
利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保链接的安全。

##### 3.隧道
隧道可按要求建立一条与其他服务器的通信线路，届时使用SSL等加密手段进行通信。隧道的目的是确保客户端与服务器进行安全的通信。

隧道本身不会去解析HTTP请求。


#### 保存资源的缓存
缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存可减少对源服务器的访问，因此就节省了通信流量和通信时间。

缓存服务器是代理服务器的一种，并归类在缓存代理类型中。

缓存服务器的优势在于利用缓存可避免多次从源服务器转发资源。因此客户端可就近从缓存服务器上获取资源，而源服务器也不必多次处理相同的请求了。

##### 缓存的有效期

##### 客户端的缓存

即便缓存服务器内有缓存，也不能保证每次都会返回对同资源的请求。因为这关系到被缓存资源的有效性问题。

当遇上源服务器上的资源更新时，如果还是使用不变的缓存，那就会演变成返回更新前的“旧”资源。

即使存在缓存，也会因为客户端的要求、缓存的有效期等因素，向源服务器确认资源的有效期。若判断缓存失效，缓存服务器将会再次从原服务器上获取“新”资源

##### 客户端的缓存

缓存不仅可以存在于缓存服务器内，还可以存在客户端浏览器中。

浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘读取。

另外，和缓存服务器相同的一点是，当判断缓存过期后，会向源服务器确认资源的有效性。若判断浏览器缓存失效，浏览器会再次请求新资源。