## 区块链

**目录**
- 默克尔树和简单支付验证
- 区块链测试
- 测试网
- 使用测试网
- 隔离网
- 私有网
- 使用私有网
- 区块链测试网中的开发

#### 1.简介
区块链的数据结构是由包含交易信息的区块按照从远及近的顺序有序链接起来的。它可以被存储为平面文件(flat file)，或是存储在一个简单数据库中。比特币核心客户端使用Google的LevelDB数据库存储区块链元数据。区块 被从远及近有序地链接在这个链条里，每个区块都指向前一个区块。区块链经常被视为一个垂直的栈，第一个区块 作为栈底的首区块，随后每个区块都被放置在之前的区块之上。

对每个区块头进行SHA256加密哈希，可生成一个哈希值。通过这个哈希值，可以识别出区块链中的对应区块。同 时， 每一个区块都可以通过其区块头的“父区块哈希值”字段引用前一区块(父区块)。也就是说，每个区块头都包 含它的父区块哈希值。这样把每个区块链接到各自父区块的哈希值序列就创建了一条一直可以追溯到第一个区块 (创世区块)的 链条。

虽然每个区块只有一个父区块，但可以暂时拥有多个子区块。每个子区块都将同一区块作为其父区块，并且在“父 区块哈希值”字段中具有相同的(父区块)哈希值。一个区块出现多个子区块的情况被称为“区块链分叉”。区块链分 叉只是暂时状态，只有当多个不同区块几乎同时被不同的矿工发现时才会发生(参见“区块链分叉”)。最终，只有 一个子区块会成为区块链的一部分，同时解决了“区块链分叉”的问题。尽管一个区块可能会有不止一个子区块，但 每一区块只有 一个父区块，这是因为一个区块只有一个“父区块哈希值”字段可以指向它的唯一父区块。

由于区块头里面包含“父区块哈希值”字段，所以当前区块的哈希值也受到该字段的影响。如果父区块的身份标识发 生变化，子区块的身份标识也会跟着变化。当父区块有任何改动时，父区块的哈希值也发生变化。这将迫使子区块 的“父区块哈希值”字段发生改变，从而又将导致子区块的哈希值发生改变。而子区块的哈希值发生改变又将迫使孙 区块的“父区块哈希值”字段发生改变，又因此改变了孙区块哈希值，以此类推。一旦一个区块有很多代以后，这种 瀑布效应将保证该区块不会被改变，除非强制重新计算该区块所有后续的区块。正是这样的重新计算需要耗费巨大 的计算量，所以一个长区块链的存在可以让区块链的历史不可改变，这也是比特币安全性的一个关键特征。

#### 2.区块结构
区块是一种被包含在公开账簿(区块链)里的聚合了交易信息的容器数据结构。它由一个包含元数据的区块头和紧 跟其后的构成区块主体的一长串交易列表组成。

#### 3.区块头
区块头由三组区块元数据组成。首先是一组引用父区块哈希值的数据，这组元数据用于将该区块与区块链中前一区 块相连接。第二组元数据，即难度、时间戳和nonce，与挖矿竞争相关，详见挖矿章节。第三组元数据是merkle树 根(一种用来有效地总结区块中所有交易的数据结构)。

Nonce、难度目标和时间戳会用于挖矿过程，更多细节将在挖矿章节讨论。

#### 4.区块标识符：区块头哈希值和区块高度
区块主标识符是它的加密哈希值，一个通过SHA256算法对区块头进行二次哈希计算而得到的数字指纹。产生的32 字节哈希值被称为区块哈希值，但是更准确的名称是:区块头哈希值，因为只有区块头被用于计算。如:000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f是第一个比特币区块的区块哈 希值。区块哈希值可以唯一、明确地标识一个区块，并且任何节点通过简单地对区块头进行哈希计算都可以独立地 获取该区块哈希值

请注意，区块哈希值实际上并不包含在区块的数据结构里，不管是该区块在网络上传输时，抑或是它作为区块链的
一部分被存储在某节点的永久性存储设备上时。相反，区块哈希值是当该区块从网络被接收时由每个节点计算出来
的。区块的哈希值可能会作为区块元数据的一部分被存储在一个独立的数据库表中，以便于索引和更快地从磁盘检
索区块。

第二种识别区块的方式是通过该区块在区块链中的位置，即“区块高度(block height)”。

区块可以通过两种方式被识别:区块哈希值或者区块高度。

和区块哈希值不同的是，区块高度并不是唯一的标识符。虽然一个单一的区块总是会有一个明确的、固定的区块高 度，但反过来却并不成立，一个区块高度并不总是识别一个单一的区块。两个或两个以上的区块可能有相同的区块 高度，在区块链里争夺同一位置。

> 一个区块的区块哈希值总是能唯一地识别出一个特定区块。一个区块也总是有特定的区块高度。但是，一个特定的区块高度并不一定总是能唯一地识别出一个特定区块。更确切地说，两个或者更多数量的区块也许会为了区块链中的一个位置而竞争。

#### 5.创世区块
区块链里的第一个区块创建于2009年，被称为创世区块。它是区块链里面所有区块的共同祖先，这意味着你从任一区块，循链向后回溯，最终都将到达创世区块。

因为创世区块被编入到比特币客户端软件里，所以每一个节点都始于至少包含一个区块的区块链，这能确保创世区 块不会被改变。每一个节点都“知道”创世区块的哈希值、结构、被创建的时间和里面的一个交易。因此，每个节点 都把该区块作为区块链的首区块，从而构建了一个安全的、可信的区块链。

#### 6.区块 链接 成为区块链
比特币的全节点在本地保存了区块链从创世区块起的完整副本。随着新的区块的产生，该区块链的本地副本会不断 地更新用于扩展这个链条。当一个节点从网络接收传入的区块时，它会验证这些区块，然后链接到现有的区块链 上。为建立一个连接，一个节点将检查传入的区块头并寻找该区块的“父区块哈希值”。

#### 7.Merkle树
区块链中的每个区块都包含了产生于该区块的所有交易，且以Merkle树表示。

Merkle树是一种哈希二叉树，它是一种用作快速归纳和校验大规模数据完整性的数据结构。这种二叉树包含加密哈 希值。术语“树”在计算机学科中常被用来描述一种具有分支的数据结构，但是树常常被倒置显示，“根”在图的上部 同时“叶子”在图的下部

在比特币网络中，Merkle树被用来归纳一个区块中的所有交易，同时生成整个交易集合的数字指纹，且提供了一种 校验区块是否存在某交易的高效途径。生成一棵完整的Merkle树需要递归地对一对节点进行哈希，并将新生成的哈 希节点插入到Merkle树中，直到只剩一个哈希节点，该节点就是Merkle树的根。在比特币的Merkle树中两次使用 到了SHA256 算法，因此其加密哈希算法也被称为double-SHA256。

当N个数据元素经过加密后插入Merkle树时，你至多计算2*log~2~(N) 次就能检查出任意某数据元素是否在该树中，这使得该数据结构非常高效。

Merkle树是自底向上构建的。

#### 8.Merkle树和简单支付验证（SPV）
Merkle树被SPV节点广泛使用。SPV节点不保存所有交易也不会下载整个区块，仅仅保存区块头。它们使用认证路
径或者Merkle路径来验证交易存在于区块中，而不必下载区块中所有交易。

#### 9.比特币的测试区块链
##### Testnet--比特币的试验场
Testnet是用于测试的区块链，网络和货币的总称。 testnet是一个功能齐全的在线P2P网络，包括钱包，测试比特 币(testnet币)，挖矿以及类似主干网的所有其他功能。实际上它和主网只有两个区别:testnet币是毫无价值 的，挖掘难度足够低，任何人都可以相对容易地使用testnet币)。

任何打算在比特币主干网上用于生产的软件开发都应该首先在testnet上用测试币进行测试。这样可以保护开发人 员免受由于软件错误而导致的金钱损失，也可以保护网络免受由于软件错误导致的意外攻击。

##### Segnet-隔离见证测试网络
##### Regtest-本地区块链

#### 10.使用测试块链进行开发
Bitcoin的各种区块链(regtest，segnet，testnet3，以及主干网)为比特币开发提供了一系列测试环境。 
