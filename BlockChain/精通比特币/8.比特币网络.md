## 比特币网络
#### P2P网络架构
比特币采用了基于国际互联网(Internet)的P2P(peer-to-peer)网络架构。P2P是指位于同一网络中的每台计算 机都彼此对等，各个节点共同提供网络服务，不存在任何“特殊”节点。每个网络节点以“扁平(flat)”的拓扑结构相 互连通。 在P2P网络中不存在任何服务端(server)、中央化的服务、以及层级结构。P2P网络的节点之间交互运 作、协同处理:每个节点在对外提供服务的同时也使用网络中其他节点所提供的服务。P2P网络也因此具有可靠 性、去中心化，以 及开放性。

在比特币之外，规模最大也最成功 的P2P技术应用是在文件分享 领域:Napster是该领域的先锋，BitTorrent是其架构的最新演变。

#### 节点类型及角色
尽管比特币P2P网络中的各个节点相互对等，但是根据所提供的功能不同，各节点可能具有不同的角色。每个比特 币节点都是路由、区块链数据库、挖矿、钱包服务的功能集合。

一些节点保有一份完整的、最新的区块链拷贝，这样的节点被称为“全节点”。全节点能够独立自主地校验所有交 易，而不需借由任何外部参照。另外还有一些节点只保留了区块链的一部分，它们通过一种名为“简易支付验证 (SPV)”的方 式来完成交易验证。这样的节点被称为“SPV节点”，又叫“轻量级节点”。

挖矿节点通过运行在特殊硬件设备上的工作量证明(proof-of-work)算法，以相互竞争的方式创建新的区块。一 些挖矿 节点同时也是全节点，保有区块链的完整拷贝;还有一些参与矿池挖矿的节点是轻量级节点，它们必须依赖 矿池服务器维护的全节点进行工作。

在比特币P2P协议中，除了这些主要的节点类型之外，还有一些服务器及节点也在运行着其他协议，例如特殊矿池 挖矿 协议、轻量级客户端访问协议等。 

#### 扩展比特币网络
运行比特币P2P协议的比特币主网络由大约5000-8000个运行着不同版本比特币核心客户端(Bitcoin Core)的监 听节 点、以及几百个运行着各类比特币P2P协议的应用(例如Bitcoin Classic, Bitcoin Unlimited, BitcoinJ, Libbitcoin, btcd, and bcoin等)的节点组成。

#### 比特币传播网络
比特币传播网络是一种尝试最小化矿工之间传输块的延迟的网络。

#### 网络发现
当新的网络节点启动后，为了能够参与协同运作，它必须发现网络中的其他比特币节点。新的网络节点必须发现至
少一个网络中存在的节点并建立连接。由于比特币网络的拓扑结构并不基于节点间的地理位置，因此各个节点之间
的地理信息完全无关。在新节点连接时，可以随机选择网络中存在的比特币节点与之相连。

#### 全节点
全节点是指维持包含全部交易信息的完整区块链的节点。更加准确地说，这样的节点应当被称为完整区块链节 点”。

#### 交换“库存清单”
一个全节点连接到对等节点之后，第一件要做的事情就是构建完整的区块链。

#### 简单支付验证节点
简易支付验证是通过参考交易在区块链中的深度，而不是高度，来验证它们。一个拥有完整区块链的节点会构造一 条验证链，这条链是由沿着区块链按时间倒序一直追溯到创世区块的数千区块及交易组成。而一个SPV节点会验证 所有区块的链(但不是所有的交易)，并且把区块链和有关交易链接起来。

#### Bloom过滤器
Bloom过滤器是一个允许用户描述特定的关键词组合而不必精确表述的基于概率的过滤方法。它能让用户在有效搜 索关键词的同时保护他们的隐私。在SPV节点里，这一方法被用来向对等节点发送交易信息查询请求，同时交易地 址不会被 暴露。

#### SPV节点如何使用Bloom过滤器
Bloom过滤器用于过滤SPV节点从其对等体接收的交易(和包含它们的块)，仅选择SPV节点感兴趣的交易，而不
会泄露其感兴趣的地址或密钥。

#### SPV节点和隐私
实现SPV的节点的隐私比整个节点更弱。完整节点接收所有交易，因此不会显示关于它的钱包中是否使用某个地址
的信息。 SPV节点接收与其钱包中的地址相关的经过过滤的列表。结果，它减少了所有者的隐私。

#### 加密和认证连接
比特币的大多数新用户假设比特币节点的网络通信是加密的。其实，比特币的原始实现就很明显地完成了。虽然这
不是完整节点的主要隐私问题，但SPV节点是一个很大的问题。

#### 交易池
比特币网络中几乎每个节点都会维护一份未确认交易的临时列表，被称为内存池或交易池。节点们利用这个池来追踪记录那些被网络所知晓、但还未被区块链所包含的交易。

随着交易被接收和验证，它们被添加到交易池并通知到相邻节点处，从而传播到网络中。
