## 超级账本项目介绍

在各界强烈的呼声中，Linux基金会于2015年12月启动了名为‘超级账本’开源项目，旨在推动各方协作，共同打造基于区块链的企业级分布式账本底层技术，用于构建支撑业务的行业应用和平台。超级账本将提供多种的区块链技术框架和代码，包含开放的协议和标准，不同的共识算法和存储模型，以及身份认证、访问控制和智能合约等服务。模块化、性能和可靠性是很重要的设计目标，用于支持各种各样的商业应用场景。

### Fabric项目

Fabric项目的目标是实现一个通用的权限区块链（Permissioned Chain）的底层基础框架。为了适用于不同的场合，采用模块化架构，提供可切换和可扩展的组件，包括共识算法、加密安全、数字资产、记录仓库、智能合约和身份鉴权等服务。Fabric克服了比特币等公有链项目的缺陷，如吞吐量低、无隐私性、无最终确定性以及共识算法低效等，使得用户能够方便地开发商业应用。

#### 应用场景

超级账本有个重要的设计原则是按照‘用例驱动’的方式来实现的，所有功能都应该有对应的用例需求。鉴于超级账本是个通用型的框架，无法预先确定将来所有的应用场景，因此定义出部分典型的用例，可使超级账本先满足这部分代表性的区块链应用需求，然后再用可替换模块来满足其他需求。目前Fabric项目主要针对下面几种用例：金融资产管存、公司行为、供应链、主数据管理以及分享经济。

#### 项目架构
Fabric的逻辑架构，底层由4种服务构成：身份服务、策略服务、区块链服务和智能合约服务。在这些服务的基础上为上层应用提供变成接口（API）/软件开发工具（SDK）以及命令行工具（CLI）
![images](1621538617822.jpg)

**1.身份服务**

Fabric是权限区块链与比特币、以太坊这类匿名的无权限区块链网络最大区别就是具有身份识别能力。在Fabric账本各类事件和交易中，参与者和对象都具有明确的身份信心。身份服务管理着系统中各种实体、参与者和对象的身份信息，包括参与的组织、验证者和交易者、账本中的资产和智能合约，系统组件以及运行环境等。验证者在Fabric网络建立的时候可以确定参加交易的权限级别。

**2.策略服务**

Fabric里面许多功能需要用策略（policy）方式驱动，因此有独立的策略服务来提供系统的策略配置和管理功能。策略服务最重要的是访问控制和授权功能，Fabric的交易通常要求参与方具有相关权限才能进行。其他的策略还包括加入和退出网络的策略，身份的注册、验证、隐私和保密的策略、共识策略等。

**3.区块链服务**

Fabric的区块链服务提供构建分布式账本最基础的能力，实现数据传输、共识达成底层功能，并且提供发布/订阅的事件管理框架，分布式账本内部的各种事件可通知到外部监听的应用。Fabric的区块链服务主要包含4个组件：P2P协议组件、分布式账本组件、共识管理器组件和账本存储组件。

- 1）P2P协议组件主要提供区块链节点之间直接双向通信的能力，包括流失数据传输、流控制、多路复用等方面。
- 2）分布式账本组件管理着Fabric的区块链数据。
- 3）共识管理器组件在各种共识算法之上定义了抽象的接口，提供给其他Fabric组件使用。
- 4）在区块链上保存大文件等数据是非常抵消的操作，因此，通常大文档要存放在链外储存中。

**4.智能合约服务**

Fabric的智能合约（smart contract）曾经称为链上代码（chaincode），其实质是在验证节点（validating node）上运行的分布式交易程序，用以自动执行特定的业务规则，最终会更新账本的状态。智能合约分为公开、保密和访问控制几种类型。公开合约可供任何一个成员调用，保密合约只能由验证成员（validating member）发起，访问控制型合约允许某些批准过的成员调用。智能合约服务为合约代码提供安全的运行环境以及合约的生命周期管理。在具体实现中，可以采用虚拟机或容器等技术，构造安全隔离的运行时。

**5.应用编程接口**
Fabric项目的目标是提供构建分布式账本的基本能力，如账本数据结构、智能合约执行环境、模块化框架，网络通信等。用户可以在Fabric基础之上调用应用编程接口（API），实现丰富的应用逻辑，灵活易用的API将大大促进围绕Fabric的生态系统的发展。Fabric的主接口采用REST API，基本与Fabric服务相对应，API分为身份、策略、区块链、交易（对应区块链服务）和智能合约等几类。为了方便应用开发，Fabric还提供命令行接口（CLI），可覆盖部分API的功能，方便测试智能合约代码以及查询交易状态。

#### 部署方式
Fabric的网络由几类节点组成：身份服务节点、验证节点、非验证节点和若干个应用节点

- 身份服务节点：负责发放和管理用户及组织的身份，具体来说就是在注册、交易、传输过程中使用的各类数字证书，以及区块链相关的密钥。
- 验证节点：创建和校验交易，并且维护智能合约的状态。在执行交易时，一般需要和其他多数的验证节点达成共识（取决于共识算法），然后才能更新本地的账本数据。每个验证节点在本地都保存一份账本的副本。
- 非验证节点：主要是接收客户端的请求，组装交易，并发往验证节点处理，从这个角度看，非验证节点像交易预处理器，并不负责交易的实际执行。为了加速客户端的查询响应速度，非验证节点在本地也保留一份账本数据的拷贝。
- 应用节点：主要提供用户端（例如浏览器或移动设备）的后台服务，在收到请求后，把交易请求直接发往（或经由非验证节点转发）验证节点处理。
![images](1661538619449.jpg)
Fabric的网络节点及拓扑

Fabric的部署方式按照实际需要可有多种形式。由于Fabric是联盟链，组成网络的节点分别属于不同的联盟成员，只要这些节点可通过网络互相连接，每个成员能够选择自己节点的部署方式：既可把节点部署在自有的数据中心，也可把节点部署到公有云中。如果在云端部署节点，需要更强的加密手段来防止公网潜在的恶意攻击。由于Fabric节点部署的多样性，规划的时候应该把通信延迟、网络故障、节点失效、网络恢复等因素综合考虑在内，以符合应用的要求。

### 交易执行
Fabric上的交易分成两种：部署智能合约和执行智能合约，智能合约可以看作部署在账本上的应用代码。Fabric客户端可以通过API提交应用代码给任意一个验证节点，该验证节点在确认是有效的应用代码后，将该应用同步到其他验证节点中。通过这份分发机制，应用的代码最终会在各个验证节点保存一份。
![images](1671538619772.jpg)
应用代码的发布过程
![images](1681538619786.jpg)
应用代码执行步骤

- 1）客户端发送执行请求给任意一个验证节点；
- 2）验证节点收到请求后，向本地账本（ledger）发送启动交易的指令；
- 3）验证节点创建隔离的运行环境，启动应用（智能合约）的代码；
- 4）应用执行过程中，更新本地账本的状态；
- 5）应用完成后，验证节点向本地账本确认交易；
- 6）验证节点向其他验证节点广播交易。

> 小结：超级账本是目前最大的区块链开源项目，集结了众多科技和金融巨头，目标是建立面向商业应用的分布式账本基础技术。介绍超级账本项目的产生背景和管理方式，并介绍了两个孵化器的项目Fabric和Sawtooth Lake的架构原理。Fabric和Sawtooth Lake都提供了分布式账本的实现，两者都采用了可拓展和插拔的模块化设计，以适应不同场景的需求。

Fabric侧重于权限控制、私密性保护和交易性能提高，Sawtooth Lake则注重于提供完整的交易家族和节能的共识算法。