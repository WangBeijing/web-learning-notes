## 区块链中的密码学技术

为了保证存储于区块链中的信息的安全与完整，区块及区块链的定义和构造中使用了包含密码哈希函数和椭圆曲线公钥密码技术在内的大量的现代密码学技术，同时，这些密码学技术也被用于设计基于工作量证明的共识算法并识别用户。

#### 哈希算法 

密码哈希函数是一类数学函数，可以在有限合理的时间内，将任意长度的消息压缩为固定长度的二进制串，其输出值成为哈希值，也称为散列值。

碰撞是与哈希函数相关的重要概念，体现着哈希函数的安全性，所谓碰撞是值两个不同的消息在同一个哈希函数作用下，具有相同的哈希值。哈希函数的安全性是指在现有的计算资源（含括时间空间资金等）下，找到一个碰撞是不可行的。

在比特币系统中使用了两个密码学哈希函数，一个是SHA256，另一个是RIPEMD160。

RIPEMD160主要用户生成比特币地址。

SH256是构造区块链所用的主要密码哈希函数。无论是区块的头部信息还是交易数据，都使用这个哈希函数去计算相关数据的哈希值，以保证数据的完整性。同时，在比特币系统中，基于寻找给定前缀的SHA256哈希值，设计了工作量证明的共识机制；SHA256也被用于构造比特币地址，即来识别不同的用户。

SHA256是一个Merkle-Damgard结构的迭代哈希函数，其计算过程分位两个阶段：消息的预处理和主循环。

![Images](1471538532696.jpg)

在比特币系统中，SHA256算法的一个主要用途是完成PoW（工作量证明）计算。

#### 哈希函数的性质与应用
密码学哈希函数的3个主要性质及其应用

- 1.抗碰撞性
- 2.原像不可逆
- 3.难题友好性

#### 哈希指针链

哈希指针是一类数据结构，除了包含通常的指针外，还包含一些数据信息以及这些信息相关的密码哈希值，这就使得正常的指针可用于取回信息，哈希指针用于验证信息是否发生改变。

区块链可以看作一类使用哈希指针的链表。链表链接一系列的区块，每个区块包含数据以及指向表中前一个区块的指针。

可以使用区块链去构造一个防篡改的日志系统。在这个系统中，基于区块链的日志节点链表被用来存储数据，链表节点通过哈希指针链接，新节点追加在日志链表的尾部。同时，日志链表的头哈希指针所指向的头节点内容不可改变。若日志链表中的每个节点数据被篡改，则系统能够检测出来。

#### Merkle树

Merkle哈希树是一类基于哈希值的二叉树或多叉树，其叶子节点上的值通常为数据块的哈希值，而非叶子节点上的值是将该节点的所有子节点的组合结果的哈希值。

在计算机领域，Merkle树大多用来验证完整性验证处理。在处理完整性验证的应用场景中，特别是在分布式环境下进行这样的验证时，Merkle树会大大减少数据的传输量以及计算的复杂度。

区块链中的Merkle树是二叉树，用于存储交易信息。每个交易两两配对，构成Merkle树的叶子节点，进而生成整个Merkle树。

#### 公钥密码算法

密码算法需要两个密钥：公开密钥和私有密钥。公开密钥和私有密钥是一堆，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法也可叫作非对称密码算法。

区块链中所使用的公钥密码算法是椭圆曲线算法那。

##### 1.椭圆曲线密码算法
椭圆曲线密码算法是基于椭圆曲线数学的一种公钥密码的算法，其安全性依赖于椭圆曲线离散对数问题的困难性。

椭圆曲线密码算具有两个明显有点：
- 1）短的密钥长度，这意味着小的带宽和存储要求
- 2）所有的用户可以选择同一基域上的不同的椭圆曲线，可使所有的用户使用同样的操作完成域运算。

##### 2.secp256k1椭圆曲线
比特币系统的区块链实现中使用的椭圆曲线为Certicom推荐的椭圆曲线secp256k1.

##### 3.椭圆曲线签名与验证签名
椭圆曲线的签名与验证算法

（1）椭圆曲线数字签名生成
（2）椭圆曲线签名验证

> 小结：区块链通常并不直接保存原始数据或者交易记录，而是保存其哈希函数值，更具体的，比特币区块链通常采用SHA256哈希函数，即将任意长度的原始数据经过两次SHA256哈希函数运算后转换为长度256位（32字节）的二进制数字来统一存储和识别。为快速归纳和校验区块链数据的存在性和完整性，Merkle树成为区块链的重要数据结构。公钥密码系统被用来实现区块链数据签名，比特币区块链中采用了椭圆曲线公钥密码系统，使用了Certicom推荐的secp256k1椭圆曲线

